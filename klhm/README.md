# Klammerhammer

A tool to read metadata from SMT-LIB problems.  Is reasonably fast, but not well
tested.

## Building

Klammerhammer needs Zig **0.13** and the C *zstd* library.

To compile a debug version and run it on an SMT-LIB file `FILENAME` run
```
> zig build run -- FILENAME
```

To get an optimized version run
```
> zig build -Doptimize=ReleaseFast
```

The compilied binary is in `./zig-out/bin/klhm`.

## Usage

Klammerhammer has no options.  It takes the path of an SMT-LIB file as
input, and produces a JSON list with JSON objects.  The objects are not
pretty-printed.  Use something like `jq` to get a human readable version.

All but the last object correspond to "sub-benchmarks":  `check-sat` calls.
The are printed in order of the `check-sat` calls and take `push` and `pop`
commands into account.  The last JSON object provides information about the
overall benchmark.

## Data Format

### Sub-benchmark Data

* `normalizedSize` size in byte of the query (taking `push` and `pop` into account)
* `compressedSize` size in bytes when compressed using zstd (default options, streaming mode)
* `assertsCount` number of `assert` commands in benchmark
* `declareFunCount` number of proper functions declared
* `declareConstCount` number of declared constants (includs 0-ary `declare-fun`)
* `declareSortCount` number of declared sorts
* `defineFunCount` number of proper functions defined
* `defineFunRecCount` number of recursive function definitions (counts individual entries in `define-funs-rec`)
* `constantFunCount` number of 0-ary function definitions
* `defineSortCount` number of defined sort
* `declareDatatypeCount` number of declared datatypes (counts individual entries in `declare-datatypes`)
* `maxTermDepth` largest term depth (approximately)
* `status` indicated status
* `symbolFrequency` array with counts of symbol occurences in terms.

The array in `symbolFrequency` follows the order in the file
`./src/smtlib-symbols` with lines starting with `;` omitted.  This file is
compiled into the `klhm` binary.  Hence, a recompilation is necessary if it is
changed.

### Benchmark Data

* `logic` the logic string
* `size` size in bytes
* `compressedSize` size in bytes when compressed using zstd (default options, streaming mode)
* `license` license string
* `generatedOn` the "Generated On" metadata header
* `generatedBy` the "Generated By" metadata header
* `targetSolver` the "Target Solver" metadata header
* `timeLimit` the "Time limit" metadata header
* `generator` the "Generator" metadata header
* `application` the application info field
* `description` any other content in the `:source` info field after the defined headers
* `category` the category info field
* `queryCount` the number of sub-benchmarks
* `isIncremental` boolean, true if `queryCount` > 1

